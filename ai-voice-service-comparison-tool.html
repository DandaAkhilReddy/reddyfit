<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice Service Comparison & Stack Builder</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .service-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .service-card.selected {
            border: 2px solid #6366f1;
            background: linear-gradient(45deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
        }
        .comparison-table td {
            transition: background 0.2s;
        }
        .comparison-table tr:hover td {
            background: rgba(99, 102, 241, 0.05);
        }
        .profit-positive { color: #10b981; font-weight: 600; }
        .profit-negative { color: #ef4444; font-weight: 600; }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="gradient-bg text-white p-8">
        <div class="container mx-auto">
            <h1 class="text-4xl font-bold mb-3">AI Voice Stack Builder & Comparison Tool</h1>
            <p class="text-xl opacity-90">Choose your services, compare costs, and optimize profitability</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-6 py-8">
        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 -mt-12 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-gray-500 text-sm font-medium">Your Stack Cost</h3>
                <p class="text-2xl font-bold text-indigo-600" id="totalCostDisplay">$0.000/min</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-gray-500 text-sm font-medium">Recommended Price</h3>
                <p class="text-2xl font-bold text-purple-600" id="recommendedPriceDisplay">$0.000/min</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-gray-500 text-sm font-medium">Profit Margin</h3>
                <p class="text-2xl font-bold" id="profitMarginDisplay">0%</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-gray-500 text-sm font-medium">Monthly Profit (100K min)</h3>
                <p class="text-2xl font-bold" id="monthlyProfitDisplay">$0</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-gray-500 text-sm font-medium">vs Competitors</h3>
                <p class="text-2xl font-bold" id="competitorComparisonDisplay">+0%</p>
            </div>
        </div>

        <!-- Service Selection Grid -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Build Your Stack</h2>

            <!-- Telephony Services -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-700">📞 Telephony Provider</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="service-card border rounded-lg p-4" onclick="selectService('telephony', 'twilio')">
                        <h4 class="font-semibold">Twilio</h4>
                        <p class="text-sm text-gray-600">Inbound: $0.0085/min</p>
                        <p class="text-sm text-gray-600">Outbound: $0.013/min</p>
                        <p class="text-xs text-green-600 mt-2">✓ Most reliable</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('telephony', 'vonage')">
                        <h4 class="font-semibold">Vonage</h4>
                        <p class="text-sm text-gray-600">Inbound: $0.0075/min</p>
                        <p class="text-sm text-gray-600">Outbound: $0.012/min</p>
                        <p class="text-xs text-blue-600 mt-2">✓ Good APIs</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('telephony', 'telnyx')">
                        <h4 class="font-semibold">Telnyx</h4>
                        <p class="text-sm text-gray-600">Inbound: $0.007/min</p>
                        <p class="text-sm text-gray-600">Outbound: $0.01/min</p>
                        <p class="text-xs text-purple-600 mt-2">✓ Best price</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('telephony', 'signalwire')">
                        <h4 class="font-semibold">SignalWire</h4>
                        <p class="text-sm text-gray-600">Inbound: $0.0065/min</p>
                        <p class="text-sm text-gray-600">Outbound: $0.01/min</p>
                        <p class="text-xs text-orange-600 mt-2">✓ Twilio compatible</p>
                    </div>
                </div>
            </div>

            <!-- AI Model -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-700">🤖 AI Model</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="service-card border rounded-lg p-4" onclick="selectService('ai', 'gpt-3.5')">
                        <h4 class="font-semibold">GPT-3.5 Turbo</h4>
                        <p class="text-sm text-gray-600">~$0.015/min</p>
                        <p class="text-xs text-green-600 mt-2">✓ Best value</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('ai', 'gpt-4')">
                        <h4 class="font-semibold">GPT-4</h4>
                        <p class="text-sm text-gray-600">~$0.06/min</p>
                        <p class="text-xs text-purple-600 mt-2">✓ Best quality</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('ai', 'claude-haiku')">
                        <h4 class="font-semibold">Claude Haiku</h4>
                        <p class="text-sm text-gray-600">~$0.01/min</p>
                        <p class="text-xs text-blue-600 mt-2">✓ Fastest</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('ai', 'gemini-pro')">
                        <h4 class="font-semibold">Gemini Pro</h4>
                        <p class="text-sm text-gray-600">~$0.012/min</p>
                        <p class="text-xs text-orange-600 mt-2">✓ Good balance</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('ai', 'llama3')">
                        <h4 class="font-semibold">Llama 3 (Self-hosted)</h4>
                        <p class="text-sm text-gray-600">~$0.003/min</p>
                        <p class="text-xs text-red-600 mt-2">⚠ Requires setup</p>
                    </div>
                </div>
            </div>

            <!-- Speech to Text -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-700">🎤 Speech-to-Text</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="service-card border rounded-lg p-4" onclick="selectService('stt', 'deepgram')">
                        <h4 class="font-semibold">Deepgram Nova</h4>
                        <p class="text-sm text-gray-600">$0.0043/min</p>
                        <p class="text-xs text-green-600 mt-2">✓ Best accuracy</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('stt', 'whisper')">
                        <h4 class="font-semibold">OpenAI Whisper</h4>
                        <p class="text-sm text-gray-600">$0.006/min</p>
                        <p class="text-xs text-purple-600 mt-2">✓ Great quality</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('stt', 'azure')">
                        <h4 class="font-semibold">Azure Speech</h4>
                        <p class="text-sm text-gray-600">$0.016/min</p>
                        <p class="text-xs text-blue-600 mt-2">✓ Enterprise ready</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('stt', 'google')">
                        <h4 class="font-semibold">Google Cloud STT</h4>
                        <p class="text-sm text-gray-600">$0.009/min</p>
                        <p class="text-xs text-orange-600 mt-2">✓ Good features</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('stt', 'assemblyai')">
                        <h4 class="font-semibold">AssemblyAI</h4>
                        <p class="text-sm text-gray-600">$0.015/min</p>
                        <p class="text-xs text-red-600 mt-2">✓ Easy API</p>
                    </div>
                </div>
            </div>

            <!-- Text to Speech -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-700">🔊 Text-to-Speech</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="service-card border rounded-lg p-4" onclick="selectService('tts', 'azure-neural')">
                        <h4 class="font-semibold">Azure Neural</h4>
                        <p class="text-sm text-gray-600">$0.008/min</p>
                        <p class="text-xs text-green-600 mt-2">✓ Best value</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('tts', 'elevenlabs')">
                        <h4 class="font-semibold">ElevenLabs</h4>
                        <p class="text-sm text-gray-600">$0.06/min</p>
                        <p class="text-xs text-purple-600 mt-2">✓ Most realistic</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('tts', 'playht')">
                        <h4 class="font-semibold">Play.ht</h4>
                        <p class="text-sm text-gray-600">$0.04/min</p>
                        <p class="text-xs text-blue-600 mt-2">✓ Good quality</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('tts', 'openai-tts')">
                        <h4 class="font-semibold">OpenAI TTS</h4>
                        <p class="text-sm text-gray-600">$0.015/min</p>
                        <p class="text-xs text-orange-600 mt-2">✓ Simple API</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('tts', 'google-wavenet')">
                        <h4 class="font-semibold">Google WaveNet</h4>
                        <p class="text-sm text-gray-600">$0.016/min</p>
                        <p class="text-xs text-red-600 mt-2">✓ Many voices</p>
                    </div>
                </div>
            </div>

            <!-- Orchestration Platform -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3 text-gray-700">🎯 Orchestration Platform (Optional)</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="service-card border rounded-lg p-4" onclick="selectService('platform', 'none')">
                        <h4 class="font-semibold">None (Direct APIs)</h4>
                        <p class="text-sm text-gray-600">$0.00/min</p>
                        <p class="text-xs text-green-600 mt-2">✓ Maximum profit</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('platform', 'vapi')">
                        <h4 class="font-semibold">Vapi.ai</h4>
                        <p class="text-sm text-gray-600">$0.08/min</p>
                        <p class="text-xs text-purple-600 mt-2">⚠ Expensive</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('platform', 'bland')">
                        <h4 class="font-semibold">Bland.ai</h4>
                        <p class="text-sm text-gray-600">$0.09/min (all-in)</p>
                        <p class="text-xs text-blue-600 mt-2">✓ All inclusive</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('platform', 'retell')">
                        <h4 class="font-semibold">Retell.ai</h4>
                        <p class="text-sm text-gray-600">$0.10/min base</p>
                        <p class="text-xs text-orange-600 mt-2">✓ Good features</p>
                    </div>
                    <div class="service-card border rounded-lg p-4" onclick="selectService('platform', 'make')">
                        <h4 class="font-semibold">Make.com Only</h4>
                        <p class="text-sm text-gray-600">$0.003/min</p>
                        <p class="text-xs text-red-600 mt-2">✓ Flexible</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comparison Tables -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Your Stack vs Competitors -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Your Stack vs Market</h2>
                <canvas id="stackComparisonChart"></canvas>
                <table class="w-full mt-4 comparison-table">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left py-2">Service</th>
                            <th class="text-right py-2">Cost/min</th>
                            <th class="text-right py-2">vs Market</th>
                        </tr>
                    </thead>
                    <tbody id="stackComparisonTable">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>

            <!-- Profitability Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Profitability Analysis</h2>
                <canvas id="profitabilityChart"></canvas>
                <div class="mt-4 space-y-3">
                    <div>
                        <label class="text-sm text-gray-600">Selling Price ($/min)</label>
                        <input type="range" id="sellingPriceSlider" min="0.05" max="0.50" step="0.01" value="0.08"
                               class="w-full" oninput="updateProfitability()">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>$0.05</span>
                            <span id="sellingPriceDisplay">$0.08</span>
                            <span>$0.50</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm text-gray-600">Monthly Volume (minutes)</label>
                        <input type="range" id="volumeSlider" min="10000" max="1000000" step="10000" value="100000"
                               class="w-full" oninput="updateProfitability()">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>10K</span>
                            <span id="volumeDisplay">100K</span>
                            <span>1M</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Make.com Integration Cost -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Make.com Automation Costs</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold mb-3">Core Plan ($9/month)</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li>✓ 10,000 operations/month</li>
                        <li>✓ ~3,333 voice calls (3 ops/call)</li>
                        <li>✓ Cost: $0.0027/call</li>
                        <li class="text-green-600 font-semibold">Best for: Testing</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">Pro Plan ($29/month)</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li>✓ 40,000 operations/month</li>
                        <li>✓ ~13,333 voice calls</li>
                        <li>✓ Cost: $0.0022/call</li>
                        <li class="text-blue-600 font-semibold">Best for: Small Business</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">Teams Plan ($99/month)</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li>✓ 150,000 operations/month</li>
                        <li>✓ ~50,000 voice calls</li>
                        <li>✓ Cost: $0.002/call</li>
                        <li class="text-purple-600 font-semibold">Best for: Scaling</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Pre-built Stack Recommendations -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Recommended Stacks</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="border rounded-lg p-4 hover:shadow-lg transition cursor-pointer" onclick="loadPreset('budget')">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg">💰 Budget Stack</h3>
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">$0.034/min</span>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-600">
                        <li>• Telnyx ($0.01/min)</li>
                        <li>• Claude Haiku ($0.01/min)</li>
                        <li>• Deepgram ($0.004/min)</li>
                        <li>• Azure TTS ($0.008/min)</li>
                        <li>• Make.com ($0.002/min)</li>
                    </ul>
                    <p class="mt-3 text-sm font-semibold text-green-600">Profit at $0.08/min: 57.5%</p>
                </div>
                <div class="border rounded-lg p-4 hover:shadow-lg transition cursor-pointer" onclick="loadPreset('balanced')">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg">⚖️ Balanced Stack</h3>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">$0.044/min</span>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-600">
                        <li>• Twilio ($0.013/min)</li>
                        <li>• GPT-3.5 ($0.015/min)</li>
                        <li>• Deepgram ($0.004/min)</li>
                        <li>• Azure TTS ($0.008/min)</li>
                        <li>• Make.com ($0.002/min)</li>
                    </ul>
                    <p class="mt-3 text-sm font-semibold text-blue-600">Profit at $0.08/min: 45%</p>
                </div>
                <div class="border rounded-lg p-4 hover:shadow-lg transition cursor-pointer" onclick="loadPreset('premium')">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg">👑 Premium Stack</h3>
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">$0.093/min</span>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-600">
                        <li>• Twilio ($0.013/min)</li>
                        <li>• GPT-4 ($0.06/min)</li>
                        <li>• Whisper ($0.006/min)</li>
                        <li>• ElevenLabs ($0.06/min)</li>
                        <li>• Make.com ($0.002/min)</li>
                    </ul>
                    <p class="mt-3 text-sm font-semibold text-purple-600">Profit at $0.20/min: 53.5%</p>
                </div>
            </div>
        </div>

        <!-- ROI Calculator -->
        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4">Quick ROI Calculator</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="text-sm opacity-90">Initial Investment</label>
                    <input type="number" id="investmentInput" value="1000" class="w-full mt-1 px-3 py-2 rounded text-gray-800"
                           oninput="calculateROI()">
                </div>
                <div>
                    <label class="text-sm opacity-90">Monthly Customers</label>
                    <input type="number" id="customersInput" value="100" class="w-full mt-1 px-3 py-2 rounded text-gray-800"
                           oninput="calculateROI()">
                </div>
                <div>
                    <label class="text-sm opacity-90">Avg Minutes/Customer</label>
                    <input type="number" id="minutesPerCustomerInput" value="500" class="w-full mt-1 px-3 py-2 rounded text-gray-800"
                           oninput="calculateROI()">
                </div>
                <div class="flex items-end">
                    <div class="w-full">
                        <p class="text-sm opacity-90 mb-1">Break-even</p>
                        <p class="text-2xl font-bold" id="breakEvenDisplay">2.1 months</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Service pricing data
        const services = {
            telephony: {
                twilio: { name: 'Twilio', cost: 0.013 },
                vonage: { name: 'Vonage', cost: 0.012 },
                telnyx: { name: 'Telnyx', cost: 0.010 },
                signalwire: { name: 'SignalWire', cost: 0.010 }
            },
            ai: {
                'gpt-3.5': { name: 'GPT-3.5', cost: 0.015 },
                'gpt-4': { name: 'GPT-4', cost: 0.060 },
                'claude-haiku': { name: 'Claude Haiku', cost: 0.010 },
                'gemini-pro': { name: 'Gemini Pro', cost: 0.012 },
                'llama3': { name: 'Llama 3', cost: 0.003 }
            },
            stt: {
                deepgram: { name: 'Deepgram', cost: 0.0043 },
                whisper: { name: 'Whisper', cost: 0.006 },
                azure: { name: 'Azure Speech', cost: 0.016 },
                google: { name: 'Google STT', cost: 0.009 },
                assemblyai: { name: 'AssemblyAI', cost: 0.015 }
            },
            tts: {
                'azure-neural': { name: 'Azure Neural', cost: 0.008 },
                elevenlabs: { name: 'ElevenLabs', cost: 0.060 },
                playht: { name: 'Play.ht', cost: 0.040 },
                'openai-tts': { name: 'OpenAI TTS', cost: 0.015 },
                'google-wavenet': { name: 'Google WaveNet', cost: 0.016 }
            },
            platform: {
                none: { name: 'None', cost: 0 },
                vapi: { name: 'Vapi.ai', cost: 0.08 },
                bland: { name: 'Bland.ai', cost: 0.09, allInclusive: true },
                retell: { name: 'Retell.ai', cost: 0.10 },
                make: { name: 'Make.com', cost: 0.003 }
            }
        };

        // Current selection
        let currentStack = {
            telephony: 'twilio',
            ai: 'gpt-3.5',
            stt: 'deepgram',
            tts: 'azure-neural',
            platform: 'none'
        };

        // Charts
        let stackChart, profitChart;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeCharts();
            updateCalculations();
        });

        function selectService(category, service) {
            // Update selection
            currentStack[category] = service;

            // Update UI
            const cards = document.querySelectorAll(`.service-card`);
            cards.forEach(card => {
                if (card.onclick && card.onclick.toString().includes(`'${category}', '${service}'`)) {
                    card.classList.add('selected');
                } else if (card.onclick && card.onclick.toString().includes(`'${category}'`)) {
                    card.classList.remove('selected');
                }
            });

            updateCalculations();
        }

        function updateCalculations() {
            // Calculate total cost
            let totalCost = 0;
            let isAllInclusive = false;

            // Check if using all-inclusive platform
            if (currentStack.platform === 'bland') {
                totalCost = services.platform.bland.cost;
                isAllInclusive = true;
            } else {
                // Add up all service costs
                Object.keys(currentStack).forEach(category => {
                    if (services[category][currentStack[category]]) {
                        totalCost += services[category][currentStack[category]].cost;
                    }
                });

                // Add infrastructure cost
                totalCost += 0.002; // Infrastructure overhead
            }

            // Update displays
            document.getElementById('totalCostDisplay').textContent = `$${totalCost.toFixed(3)}/min`;

            // Recommended price (2.5x cost for healthy margin)
            const recommendedPrice = totalCost * 2.5;
            document.getElementById('recommendedPriceDisplay').textContent = `$${recommendedPrice.toFixed(3)}/min`;

            // Profit margin at $0.08/min
            const sellingPrice = parseFloat(document.getElementById('sellingPriceSlider').value);
            const margin = ((sellingPrice - totalCost) / sellingPrice * 100);
            document.getElementById('profitMarginDisplay').textContent = margin > 0 ? `${margin.toFixed(1)}%` : `${margin.toFixed(1)}%`;
            document.getElementById('profitMarginDisplay').className = margin > 0 ? 'text-2xl font-bold profit-positive' : 'text-2xl font-bold profit-negative';

            // Monthly profit
            const monthlyVolume = parseFloat(document.getElementById('volumeSlider').value);
            const monthlyProfit = (sellingPrice - totalCost) * monthlyVolume;
            document.getElementById('monthlyProfitDisplay').textContent = monthlyProfit > 0
                ? `$${monthlyProfit.toLocaleString()}`
                : `-$${Math.abs(monthlyProfit).toLocaleString()}`;
            document.getElementById('monthlyProfitDisplay').className = monthlyProfit > 0
                ? 'text-2xl font-bold profit-positive'
                : 'text-2xl font-bold profit-negative';

            // vs Competitors
            const competitorAvg = 0.12; // Average competitor price
            const comparison = ((competitorAvg - sellingPrice) / competitorAvg * 100);
            document.getElementById('competitorComparisonDisplay').textContent = comparison > 0
                ? `-${comparison.toFixed(0)}%`
                : `+${Math.abs(comparison).toFixed(0)}%`;
            document.getElementById('competitorComparisonDisplay').className = comparison > 0
                ? 'text-2xl font-bold profit-positive'
                : 'text-2xl font-bold profit-negative';

            updateCharts();
            updateComparisonTable();
        }

        function initializeCharts() {
            // Stack Comparison Chart
            const stackCtx = document.getElementById('stackComparisonChart').getContext('2d');
            stackChart = new Chart(stackCtx, {
                type: 'bar',
                data: {
                    labels: ['Your Stack', 'Bland.ai', 'Vapi+APIs', 'Retell.ai', 'Direct Avg'],
                    datasets: [{
                        label: 'Cost per minute',
                        data: [0, 0.09, 0.256, 0.15, 0.08],
                        backgroundColor: ['#10b981', '#6b7280', '#6b7280', '#6b7280', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });

            // Profitability Chart
            const profitCtx = document.getElementById('profitabilityChart').getContext('2d');
            profitChart = new Chart(profitCtx, {
                type: 'line',
                data: {
                    labels: ['10K', '25K', '50K', '100K', '250K', '500K', '1M'],
                    datasets: [{
                        label: 'Monthly Profit',
                        data: [],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value/1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            // Update stack comparison
            let totalCost = 0;
            Object.keys(currentStack).forEach(category => {
                if (services[category][currentStack[category]]) {
                    totalCost += services[category][currentStack[category]].cost;
                }
            });
            totalCost += 0.002;

            stackChart.data.datasets[0].data[0] = totalCost;
            stackChart.update();

            // Update profitability
            const sellingPrice = parseFloat(document.getElementById('sellingPriceSlider').value);
            const volumes = [10000, 25000, 50000, 100000, 250000, 500000, 1000000];
            const profits = volumes.map(vol => (sellingPrice - totalCost) * vol);

            profitChart.data.datasets[0].data = profits;
            profitChart.update();
        }

        function updateComparisonTable() {
            const table = document.getElementById('stackComparisonTable');
            const competitors = [
                { name: 'Bland.ai', cost: 0.09 },
                { name: 'Vapi + APIs', cost: 0.256 },
                { name: 'Retell.ai', cost: 0.15 },
                { name: 'Synthflow', cost: 0.12 },
                { name: 'Air.ai', cost: 0.275 }
            ];

            let totalCost = 0;
            Object.keys(currentStack).forEach(category => {
                if (services[category][currentStack[category]]) {
                    totalCost += services[category][currentStack[category]].cost;
                }
            });
            totalCost += 0.002;

            let html = '';
            competitors.forEach(comp => {
                const diff = ((totalCost - comp.cost) / comp.cost * 100);
                const diffClass = diff < 0 ? 'profit-positive' : 'profit-negative';
                const diffText = diff < 0 ? `${Math.abs(diff).toFixed(0)}% less` : `${diff.toFixed(0)}% more`;

                html += `
                    <tr class="border-b">
                        <td class="py-2">${comp.name}</td>
                        <td class="text-right">$${comp.cost.toFixed(3)}</td>
                        <td class="text-right ${diffClass}">${diffText}</td>
                    </tr>
                `;
            });

            table.innerHTML = html;
        }

        function updateProfitability() {
            const price = document.getElementById('sellingPriceSlider').value;
            const volume = document.getElementById('volumeSlider').value;

            document.getElementById('sellingPriceDisplay').textContent = `$${parseFloat(price).toFixed(2)}`;
            document.getElementById('volumeDisplay').textContent = `${(volume/1000).toFixed(0)}K`;

            updateCalculations();
        }

        function loadPreset(type) {
            if (type === 'budget') {
                currentStack = {
                    telephony: 'telnyx',
                    ai: 'claude-haiku',
                    stt: 'deepgram',
                    tts: 'azure-neural',
                    platform: 'make'
                };
            } else if (type === 'balanced') {
                currentStack = {
                    telephony: 'twilio',
                    ai: 'gpt-3.5',
                    stt: 'deepgram',
                    tts: 'azure-neural',
                    platform: 'make'
                };
            } else if (type === 'premium') {
                currentStack = {
                    telephony: 'twilio',
                    ai: 'gpt-4',
                    stt: 'whisper',
                    tts: 'elevenlabs',
                    platform: 'make'
                };
                document.getElementById('sellingPriceSlider').value = 0.20;
            }

            // Update UI selections
            Object.keys(currentStack).forEach(category => {
                const cards = document.querySelectorAll('.service-card');
                cards.forEach(card => {
                    if (card.onclick && card.onclick.toString().includes(`'${category}', '${currentStack[category]}'`)) {
                        card.classList.add('selected');
                    } else if (card.onclick && card.onclick.toString().includes(`'${category}'`)) {
                        card.classList.remove('selected');
                    }
                });
            });

            updateCalculations();
        }

        function calculateROI() {
            const investment = parseFloat(document.getElementById('investmentInput').value) || 1000;
            const customers = parseFloat(document.getElementById('customersInput').value) || 100;
            const minutesPerCustomer = parseFloat(document.getElementById('minutesPerCustomerInput').value) || 500;
            const sellingPrice = parseFloat(document.getElementById('sellingPriceSlider').value);

            let totalCost = 0;
            Object.keys(currentStack).forEach(category => {
                if (services[category][currentStack[category]]) {
                    totalCost += services[category][currentStack[category]].cost;
                }
            });
            totalCost += 0.002;

            const monthlyRevenue = customers * minutesPerCustomer * sellingPrice;
            const monthlyCosts = customers * minutesPerCustomer * totalCost;
            const monthlyProfit = monthlyRevenue - monthlyCosts;

            const breakEvenMonths = investment / monthlyProfit;

            document.getElementById('breakEvenDisplay').textContent =
                breakEvenMonths > 0 ? `${breakEvenMonths.toFixed(1)} months` : 'Never';
        }

        // Initialize on load
        loadPreset('balanced');
    </script>
</body>
</html>